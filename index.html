<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scouting 2022</title>

    <script>
        /*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
    var saveAs=saveAs||function(e){"use strict";if(typeof e==="undefined"||typeof navigator!=="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent)){return}var t=e.document,n=function(){return e.URL||e.webkitURL||e},r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in r,a=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},i=/constructor/i.test(e.HTMLElement)||e.safari,f=/CriOS\/[\d]+/.test(navigator.userAgent),u=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},s="application/octet-stream",d=1e3*40,c=function(e){var t=function(){if(typeof e==="string"){n().revokeObjectURL(e)}else{e.remove()}};setTimeout(t,d)},l=function(e,t,n){t=[].concat(t);var r=t.length;while(r--){var o=e["on"+t[r]];if(typeof o==="function"){try{o.call(e,n||e)}catch(a){u(a)}}}},p=function(e){if(/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)){return new Blob([String.fromCharCode(65279),e],{type:e.type})}return e},v=function(t,u,d){if(!d){t=p(t)}var v=this,w=t.type,m=w===s,y,h=function(){l(v,"writestart progress write writeend".split(" "))},S=function(){if((f||m&&i)&&e.FileReader){var r=new FileReader;r.onloadend=function(){var t=f?r.result:r.result.replace(/^data:[^;]*;/,"data:attachment/file;");var n=e.open(t,"_blank");if(!n)e.location.href=t;t=undefined;v.readyState=v.DONE;h()};r.readAsDataURL(t);v.readyState=v.INIT;return}if(!y){y=n().createObjectURL(t)}if(m){e.location.href=y}else{var o=e.open(y,"_blank");if(!o){e.location.href=y}}v.readyState=v.DONE;h();c(y)};v.readyState=v.INIT;if(o){y=n().createObjectURL(t);setTimeout(function(){r.href=y;r.download=u;a(r);h();c(y);v.readyState=v.DONE});return}S()},w=v.prototype,m=function(e,t,n){return new v(e,t||e.name||"download",n)};if(typeof navigator!=="undefined"&&navigator.msSaveOrOpenBlob){return function(e,t,n){t=t||e.name||"download";if(!n){e=p(e)}return navigator.msSaveOrOpenBlob(e,t)}}w.abort=function(){};w.readyState=w.INIT=0;w.WRITING=1;w.DONE=2;w.error=w.onwritestart=w.onprogress=w.onwrite=w.onabort=w.onerror=w.onwriteend=null;return m}(typeof self!=="undefined"&&self||typeof window!=="undefined"&&window||this.content);if(typeof module!=="undefined"&&module.exports){module.exports.saveAs=saveAs}else if(typeof define!=="undefined"&&define!==null&&define.amd!==null){define("FileSaver.js",function(){return saveAs})}
        </script>


    <style>
        * {
            box-sizing: border-box;
        }

        h2 {
            text-align: center;
        }

        .col {
            width: 33.33%;
            float: left;
        }

        input[type=checkbox]{
            height: 35px;
            width: 35px;
        }

        button{
            height: 45px;
            
            border-radius: 5px;
            background-color: var(--primary-color);
            color: var(black);
            border: var(--main-dark);
            border-style: solid;
        }

        #debutMatch {
            height: 75px;
        }
        :root {
            --main-darklg: #414141;
            --main-dark: #161d29;
            --primary-color: #fff347;
            --main-light: #FFFFFF;
            }


        body{
            text-align: center;
            background-color: var(--main-darklg);
            color: var(--main-light);
        }
                


    </style>

</head>
<body>
    
    <h2 id="stateMatch">État du match</h2>
    <h3 id="matchTime" class="hiddenBeforeMatch">Match Time: </h3>
    <div class="col">


        <h4>Nom du scouter:</h4>
        <input name="scouterName" type="text" id="scouterName" class="toExport">
        <h4># du match</h4>
        <input name="matchNb" type="number" id="matchNb" class="toExport">
        <h4># de l'Équipe</h4>
        <input name="teamNb" type="number" id="teamNb" class="toExport">
        <p>Ballon départ</p>
        <input name="nbBallonDepart" type="number" id="nbBallonDepart" class="toExport"><br>
        <button id="debutMatch" onclick="debutMatch()">Début de match</button><br>

        <div class="hiddenBeforeMatch">
            <h4>Mode Autonome</h4>
            <input name="autoTraverserLigne" type="checkbox" id="autoTraverserLigne" class="toExport">A traverser ligne?<br>
            <p>Ballons Bottom Auto</p>
            <button onclick="autoBallonBottom.value--">-</button><input name="autoBallonBottom" type="number" id="autoBallonBottom" value="0"><button onclick="autoBallonBottom.value++">+</button>
            <p>Ballons Upper Auto</p>
            <button onclick="autoBallonUpper.value--">-</button><input name="autoBallonUpper" type="number" id="autoBallonUpper" value="0"><button onclick="autoBallonUpper.value++">+</button>
            <p>Ballons Manqués Auto</p>
            <button onclick="autoBallonManque.value--">-</button><input name="autoBallonManque" type="number" id="autoBallonManque" value="0"><button onclick="autoBallonManque.value++">+</button><br>


        </div>


    </div>

    <div class="col hiddenBeforeMatch">
        <h4>Teleop</h4>

        <button id="tireBallon" onclick="tireDesBallon()">Tire</button><br>
        <div id="tire" style="display: none;">
            <p>Ballons Bottom</p>
            <button onclick="BallonBottom.value--">-</button><input name="BallonBottom" type="number" id="BallonBottom" value="0"><button onclick="BallonBottom.value++">+</button>
            <p>Ballons Upper</p>
            <button onclick="BallonUpper.value--">-</button><input name="BallonUpper" type="number" id="BallonUpper" value="0"><button onclick="BallonUpper.value++">+</button>
            <p>Ballons Manqués</p>
            <button onclick="BallonManque.value--">-</button><input name="BallonManque" type="number" id="BallonManque" value="0"><button onclick="BallonManque.value++">+</button><br>
            
        </div>

        <button id="defense" onclick="faitDefense()">Fait Défense</button><br>
        <button id="grimpe" onclick="grimper()">Grimpe</button><br>
        <p>Commentaire:</p><br>
        <textarea name="commentaire" id="commentaire" class="toExport"></textarea><br>
        <button id="finMatch" onclick="finMatch()">Fin de match</button>

    </div>

    <div class="col hiddenBeforeMatch">
        <h4>Peut ramasser des ballons</h4>
        <input name="ramasseParTerre" type="checkbox" id="ramasseParTerre" class="toExport">Par terre<br>
        <input name="ramasseFeedingStation" type="checkbox" id="ramasseFeedingStation" class="toExport">Feeding Station<br>
        <h4>Endgame</h4>
        <input name="grimpePas" type="checkbox" id="grimpePas" class="toExport">Ne grimpe pas<br>
        <input name="grimpeUn" type="checkbox" id="grimpeUn" class="toExport">Grimpe un étage<br>
        <input name="grimpeDeux" type="checkbox" id="grimpeDeux" class="toExport">Grimpe deux étages<br>
        <input name="grimpeTrois" type="checkbox" id="grimpeTrois" class="toExport">Grimpe trois étages<br>
        <input name="grimpeQuatre" type="checkbox" id="grimpeQuatre" class="toExport">Grimpe quatres étages<br>
        <h4>Pins</h4>
        <p>Nombre de pin reçu</p>
        <button onclick="pinRecu.value--">-</button><input name="pinRecu" type="number" id="pinRecu" class="toExport" value="0"><button onclick="pinRecu.value++">+</button><br>
        <input name="bougePin" type="checkbox" id="bougePin" class="toExport">Bouge pendant pin?<br>
        <p>Nombre de pin initié</p>
        <button onclick="pinInitie.value--">-</button><input name="pinInitie" type="number" id="pinInitie" class="toExport" value="0"><button onclick="pinInitie.value++">+</button>
        <p>Nombre de pénalité causé par les pins</p>
        <button onclick="penoPin.value--">-</button><input name="penoPin" type="number" id="penoPin" class="toExport" value="0"><button onclick="penoPin.value++">+</button>

        
    </div>



</body>

<script>


var timers = [];
var ballonsTires = [];
var tempsDefense = [];
var tempsGrimper = [];



function exportAll(){
    var thingsToExport = document.getElementsByClassName("toExport");

    var outArray = {};

    for (var i = 0; i < thingsToExport.length; i++) {
        var element = thingsToExport[i];
            //console.log(element.value);

        if (element.type == "checkbox"){
                outArray[element.name] = element.checked;
        }else{
            outArray[element.name] = element.value;
        }
    }
    outArray["tempsGrimper"] = tempsGrimper;
    outArray["ballonsTirer"] = ballonsTires;
    outArray["TimeDefense"] = tempsDefense;
    return outArray;
}



function setHiddenStyle(nomStyle){
    var elements = document.getElementsByClassName("hiddenBeforeMatch");
    for (let index = 0; index < elements.length; index++) {
        elements[index].style.display = nomStyle;
        
    }
}

setHiddenStyle("none");

function startTimer(name){
        timers[name] = ((new Date()).getTime() / 1000);
    }

function getTimer(name){
    return(((new Date()).getTime() / 1000) - timers[name]);
}

var interval = setInterval(setMatchState, 1000);

function setMatchState(){
    
    if (getTimer("match")) {
        matchTime.innerText = "Remaining Match Time: " + Math.ceil(150-getTimer("match"));
        if (getTimer("match") >= 16) {
            stateMatch.innerText = "Teleop"
            if (getTimer("match") >= 121) {
                stateMatch.innerText = "EndGame";
                if (getTimer("match") >= 151) {
                    stateMatch.innerText = "Match finished"
                    matchTime.innerText = "Remaining Match Time: 0";
                }
            }
        }
    }
}

function tireDesBallon(){
    if (tireBallon.innerText == "Tire") {
        var timeMatch = getTimer("match");
        
        tire.style.display = "initial";
        tireBallon.style.backgroundColor = "Red";
        tireBallon.style.color = "White";

        tireBallon.innerText = "Enregistrer";
    }else {
        var nbBallons = {};
        nbBallons["bottom"] = BallonBottom.value;
        nbBallons["upper"] = BallonUpper.value;
        nbBallons["manque"] = BallonManque.value;

        nbBallons["autoBottom"] = autoBallonBottom.value;
        nbBallons["autoUpper"] = autoBallonUpper.value;
        nbBallons["autoManque"] = autoBallonManque.value;

        BallonBottom.value = 0;
        BallonUpper.value = 0;
        BallonManque.value = 0;

        tire.style.display = "none";
        tireBallon.style.backgroundColor = "#fff347";
        tireBallon.style.color = "black";

        ballonsTires.push(nbBallons);

        tireBallon.innerText = "Tire";
    }
}




function faitDefense(){
    if (defense.innerText == "Fait Défense") {
        var timeMatch = getTimer("match");
        startTimer("faitDefense");
        defense.style.backgroundColor = "Red";
        defense.style.color = "White";
        defense.innerText = "Fini Défense";

    }else {
        var timeDefense = getTimer("faitDefense");
        tempsDefense.push(timeDefense);
        defense.style.backgroundColor = "#fff347";
        defense.style.color = "black";
        defense.innerText = "Fait Défense";

        
    }
}

function grimper(){
    if (grimpe.innerText == "Grimpe") {
        var timeMatch = getTimer("match");
        startTimer("grimpe");
        grimpe.style.backgroundColor = "Red";
        grimpe.style.color = "White";
        grimpe.innerText = "Fini Grimper";

    }else {
        var timeGrimper = getTimer("grimpe");
        tempsGrimper.push(timeGrimper);
        grimpe.style.backgroundColor = "#fff347";
        grimpe.style.color = "black";
        grimpe.innerText = "Grimpe";

        
    }
}

function debutMatch(){
    startTimer("match");
    setHiddenStyle("initial");
    stateMatch.innerText = "Autonomous";
}

function finMatch(){
    var blob = new Blob([JSON.stringify(exportAll())], {type: "text/plain;charset=utf-8"});
    saveAs(blob, "m" + exportAll().matchNb + "t" + exportAll().teamNb);
}

</script>
</html>